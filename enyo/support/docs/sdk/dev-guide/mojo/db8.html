<!DOCTYPE html>
<html>
	<head>
		<title>$if(pagetitle)$$pagetitle$$endif$</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<link rel="stylesheet" href="_css/chrome.css" />
		<link rel="stylesheet" href="../_css/chrome.css" />
		<link rel="stylesheet" href="../../_css/chrome.css" />
		<link rel="stylesheet" href="../../../_css/chrome.css" />
		<script src="_js/jquery-1.4.2.min.js" type="text/javascript"></script>
		<script src="../_js/jquery-1.4.2.min.js" type="text/javascript"></script>
		<script src="../../_js/jquery-1.4.2.min.js" type="text/javascript"></script>
		<script src="../../../_js/jquery-1.4.2.min.js" type="text/javascript"></script>
		<script src="_js/doc.js" type="text/javascript"></script>
		<script src="../_js/doc.js" type="text/javascript"></script>
		<script src="../../_js/doc.js" type="text/javascript"></script>
		<script src="../../../_js/doc.js" type="text/javascript"></script>
	</head>
	<body>
		<div id="content">
    
    <h1 id="db8">
      db8
    </h1>
    <p>
      db8 is an addition to the webOS JavaScript Framework's current storage methods that is designed to meet the needs of robust, high-performance applications. db8 is a service—<code>com.palm.db</code>—available on the device bus that interfaces to an embedded JSON database. JavaScript applications have two options for interfacing to this service:
    </p>
    <ol style="list-style-type: decimal">
      <li>
        <p>
          <a href="/reference/javascript-libraries/foundations/foundations-data-db.html">JavaScript Wrapper API</a> -- API calls provided with the JavaScript Foundation libraries to interface with the db8 service.
        </p>
      </li>
      <li>
        <p>
          <a href="/reference/services/db8.html">Using serviceRequest</a> -- Call the db8 service using the <code>&quot;serviceRequest&quot;</code> API. See the <a href="/dev-guide/mojo/services-overview.html">Services Overview</a> for more information on using this call.
        </p>
      </li>
    </ol>
    <p>
      <strong>Note:</strong> It is assumed the reader has basic knowledge of database concepts and SQL operations. This article focuses on information specific to db8.
    </p>
    <p>
      <strong>In this section:</strong>
    </p>
    <ul>
      <li>
        <a href="#Features">db8 Features</a>
      </li>
      <li>
        <a href="#BasicSteps">Basic Steps</a>
      </li>
      <li>
        <a href="#DB8StoresJSONObjects">db8 Stores JSON Objects</a>
        <ul>
          <li>
            <a href="#SpecialProps">Special Properties for db8 JSON Objects</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#QueriesAndIndexing">Queries and Indexing</a>
      </li>
      <li>
        <a href="#Atomicity">Atomicity and Optimistic Concurrency</a>
      </li>
      <li>
        <a href="#SchemaEnforcement">Schema Enforcement</a>
      </li>
      <li>
        <a href="#ChangeNotifications">Change Notifications</a>
        <ul>
          <li>
            <a href="#UsingRevSets">Using Revision Sets</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#Permissions">Allowing Other Apps or Services to Access Your db8 Data</a>
      </li>
      <li>
        <a href="#db8FAQ">db8 FAQ</a>
      </li>
    </ul>
    <p>
      <strong>See also:</strong>
    </p>
    <ul>
      <li>
        <a href="/reference/data-types/db8.html">db8 Data Types</a> -- Schemas of data objects used in API calls.
      </li>
      <li>
        <a href="/dev-guide/mojo/db8-luna-send-examples.html">db8 Luna Send Examples</a> -- Command-line examples of db8 service calls.
      </li>
    </ul>
    <p>
      <a name="Features" id="Features">&#160;</a>
    </p>
    <hr>
    <h2 id="db8-features">
      db8 Features
    </h2>
    <p>
      db8 features include:
    </p>
    <ul>
      <li>High speed access and queries.
      </li>
      <li>Stores <a href="http://en.wikipedia.org/wiki/JSON">JSON</a> objects. JSON (JavaScript Object Notation) is derived from JavaScript and is the de facto web app standard for persisting data (more compact than XML).
      </li>
      <li>Designed for syncing with cloud computing and apps such as Facebook or Google.
      </li>
      <li>App-aware access control.
      </li>
      <li>Paging support for queries that can retrieve up to 500 objects at a time.
      </li>
      <li>
        <a href="#ChangeNotifications">Change notification</a> support.
      </li>
      <li>[JavaScript API] [db8-service] interface.
      </li>
      <li>Optional backing up of data storage. If the user moves to another device, saved app data can be restored.
      </li>
      <li>Data object validation through <a href="#SchemaEnforcement">schema enforcement</a>.
      </li>
    </ul>
    <p>
      <strong>Note:</strong> Though a vast improvement on current webOS storage mechanisms, db8 is not a fully-featured database supporting a rich set of SQL or SQL-like commands.
    </p>
    <p>
      <a name="Basic Steps" id="Basic Steps">&#160;</a>
    </p>
    <hr>
    <h2 id="basic-steps">
      Basic Steps
    </h2>
    <p>
      If you decide to use db8 storage in your code, here are the basic steps you need to follow to set this up:
    </p>
    <ol style="list-style-type: decimal">
      <li>
        <p>
          Determine what you are going to store -- see <a href="#DB8StoresJSONObjects">db8 Stores JSON Objects</a>.
        </p>
      </li>
      <li>
        <p>
          Determine what your indexes are going to be. This is <strong>very important</strong>, as the indexes you create determine the kind of queries you can do. See <a href="#QueriesAndIndexing">Queries and Indexing</a>.
        </p>
      </li>
      <li>
        <p>
          Decide if you want to use the <a href="/reference/javascript-libraries/foundations/foundations-data-db.html">JavaScript Wrapper API</a> or the <a href="/reference/services/db8.html">serviceRequest API</a> to set up and access your database.
        </p>
      </li>
      <li>
        <p>
          Use one of the API's <code>putKind</code> calls to create a <em>kind</em>. Once you have done that, your app can store data objects <em>of that kind</em>.
        </p>
      </li>
      <li>
        <p>
          Determine what other apps or services can access your data, such as the new <a href="/dev-guide/mojo/just-type.html">Just Type</a> service. See <a href="#Permissions">Allowing Other Apps or Services to Access Your db8 Data</a>.
        </p>
      </li>
      <li>
        <p>
          Start storing your data with the <code>put</code> call.
        </p>
      </li>
    </ol>
    <p>
      <a name="DB8StoresJSONObjects" id="DB8StoresJSONObjects">&#160;</a>
    </p>
    <hr>
    <h2 id="db8-stores-json-objects">
      db8 Stores JSON objects
    </h2>
    <p>
      JSON is a lightweight data-interchange text format based on a subset of the JavaScript programming language that is easy for humans to read and write and for machines to parse and generate. Like XML, JSON contains name/value pair collections and ordered list of values (i.e., arrays).
    </p>
    <p>
      db8 stores two types of JSON objects you need to know about:
    </p>
    <ol style="list-style-type: decimal">
      <li>
        <p>
          <strong>Kind objects</strong> -- JSON objects that define the owner, schema, and indexes for JSON data objects. The indexes determine the type of queries that can be made. In db8, these objects are known as <strong><em>kinds</em></strong>. Before a data object can be saved, its defining kind object must be stored and registered with the <code>&quot;putKind&quot;</code> call.
        </p>
      </li>
      <li>
        <p>
          <strong>Data objects</strong> -- JSON objects of a particular <em>kind</em> that contain data. Similar to objects that are instances of classes in object-oriented programming.
        </p>
      </li>
    </ol>
    <p>
      For more information about JSON, see the following websites:
    </p>
    <ul>
      <li>JSON objects, values and format -- <a href="http://www.json.org/">http://www.json.org/</a>
      </li>
      <li>JSON schemas -- <a href="http://tools.ietf.org/html/draft-zyp-json-schema-02">http://tools.ietf.org/html/draft-zyp-json-schema-02</a>
      </li>
    </ul>
    <p>
      Consult the two links above for information on formatting JSON objects. However, in brief:
    </p>
    <ul>
      <li>Curly brackets ('{', '}') are used to enclose objects.
      </li>
      <li>Angle brackets ('[', ']') are used to enclose arrays.
      </li>
      <li>Colons (':') are used as name/value delimiters.
      </li>
      <li>Quotes (&quot;) are used for string values. Numeric and boolean values do not require quotes.
      </li>
    </ul>
    <h3 id="example-json-data-object">
      Example JSON data object
    </h3>
    <p>
      The following is a fully-formatted JSON data object for a hypothetical contacts database:
    </p>
    <blockquote>
      <pre>
<code>{
  &quot;displayName&quot;  : &quot;John Doe&quot;,
  &quot;name&quot;         : {&quot;familyName&quot;:&quot;Doe&quot;, &quot;givenName&quot;:&quot;John&quot;},
  &quot;nickname&quot;     : &quot;Skippy&quot;,
  &quot;emails&quot;       : [ &quot;jdoe@gmail.com&quot;, &quot;john.doe@palm.com&quot;, &quot;jdoe99@gmail.com&quot; ]
}
</code>
</pre>
    </blockquote>
    <p>
      This documentation uses a simplified form of defining JSON objects that, for the above object, would look like this:
    </p>
    <blockquote>
      <pre>
<code>{
  &quot;displayName&quot; : string,
  &quot;name&quot;        : {
      &quot;familyName&quot; : string,
      &quot;givenName&quot;  : string
  },
  &quot;nickname&quot;    : string,
  &quot;emails&quot;      : string array
}
</code>
</pre>
    </blockquote>
    <p>
      Before you could store this data object, your app would need to create its kind object with the <code>&quot;putKind&quot;</code> API. For the example data object, the parameters to this call would look something like this:
    </p>
    <blockquote>
      <pre>
<code>{
  &quot;id&quot;      :  &quot;com.palm.contact:1&quot;,
  &quot;owner&quot;   :  &quot;com.palm.contacts&quot;,
  &quot;extends&quot; :  [&quot;PimObject:1&quot;],
  &quot;indexes&quot; :  [{&quot;name&quot;:&quot;dname&quot;, &quot;props&quot;:[{&quot;name&quot;:&quot;displayName&quot;}]}]
}
</code>
</pre>
    </blockquote>
    <p>
      Note the following about this example:
    </p>
    <ul>
      <li>
        <p>
          The <code>id</code> property has a version number. This is required and is appended to the end (i.e., &quot;:1&quot;) of the property value field. Initially, this number should be &quot;1&quot; and incremented whenever a version of this kind is updated that is not backward-compatible with previous versions.
        </p>
      </li>
      <li>
        <p>
          It <em>extends</em> another kind object (<code>PimObject:1</code>). Kinds can extend other kinds.
        </p>
      </li>
      <li>
        <p>
          The <code>owner</code> property is the bus address of the service's appId of the app that owns this kind. This is the only caller that has permission to modify the kind.
        </p>
      </li>
      <li>
        <p>
          The <code>indexes</code> property defines the <code>displayName</code> property as the one index property. How you define indexes for your kind objects determines the kind of queries your app can do. See <a href="#QueriesAndIndexing">Queries and Indexing</a> for more information.
        </p>
      </li>
    </ul>
    <p>
      <a name="SpecialProps" id="SpecialProps">&#160;</a>
    </p>
    <h3 id="special-properties-for-db8-json-objects">
      Special Properties for db8 JSON Objects
    </h3>
    <p>
      There are some special properties that db8 assigns to objects. These are delineated with an underscore ('_') based on JSON DB conventions. Because of this, applications cannot create properties that start with an underscore.
    </p>
    <p>
      Currently, the following special properties are assigned to stored objects:
    </p>
    <ul>
      <li>
        <p>
          <strong>_id</strong> -- An object's globally unique identifier. This is assigned even if the object is contained in another object. If not already assigned, the database assigns one. Meant to be an opaque object within a JSON object and it is, therefore, advised your code not make any assumptions about this field.
        </p>
      </li>
      <li>
        <p>
          <strong>_rev</strong> -- Each database instance maintains a globally-unique revision counter that is incremented after every object update or change. An object is assigned this counter each time it is modified. No two objects can ever have the same value for this field. You can use this number as a base point for syncing and in your queries, i.e., &quot;Give me all the changes that were made to contacts since the revision number from yesterday's update.&quot;
        </p>
      </li>
      <li>
        <p>
          <strong>_kind</strong> -- Applications are required to assign this string kind identifier (without the underscore).
        </p>
      </li>
    </ul>
    <p>
      Here is a sample contacts object once it has been assigned special properties:
    </p>
    <blockquote>
      <pre>
<code>{
  &quot;_id&quot;          : &quot;2+n4&quot;,
  &quot;_rev&quot;         : 276,
  &quot;_kind&quot;        : &quot;com.palm.contact:1&quot;,
  &quot;displayName&quot;  : &quot;John Doe&quot;,
  &quot;name&quot;         : {&quot;familyName&quot;:&quot;Doe&quot;, &quot;givenName&quot;:&quot;John&quot;},
  &quot;nickname&quot;     : &quot;Skippy&quot;,
  &quot;emails&quot;       : [ &quot;jdoe@gmail.com&quot;, &quot;john.doe@palm.com&quot;, &quot;jdoe99@gmail.com&quot; ]
}
</code>
</pre>
    </blockquote>
    <p>
      <a name="QueriesAndIndexing" id="QueriesAndIndexing">&#160;</a>
    </p>
    <hr>
    <h2 id="queries-and-indexing">
      Queries and Indexing
    </h2>
    <p>
      db8 queries take the following form:
    </p>
    <blockquote>
      <pre>
<code>{
  &quot;select&quot;  : string array,
  &quot;from&quot;    : string,
  &quot;where&quot;   : [ {
      &quot;prop&quot;    : string,
      &quot;op&quot;      : string,
      &quot;val&quot;     : any
  } ]
  &quot;orderBy&quot; : string,
  &quot;desc&quot;    : boolean,
  &quot;incDel&quot;  : boolean,
  &quot;limit&quot;   : integer,
  &quot;page&quot;    : string
}
</code>
</pre>
    </blockquote>
    <p>
      See the <a href="/reference/data-types/db8.html#Query">Query</a> object documentation for field descriptions.
    </p>
    <p>
      <strong>For example:</strong> (Give me the display name and state for all contacts living in California, order by display name, return in descending order, include records that have been deleted, return up to 40 records, and use the &quot;next page&quot; key returned from the previous query.)
    </p>
    <blockquote>
      <pre>
<code>{
  &quot;select&quot;  : [&quot;displayName&quot;, &quot;state&quot;],
  &quot;from&quot;    : &quot;com.mystuff.contacts:1&quot;,
  &quot;where&quot;   : [{&quot;prop&quot;:&quot;state&quot;,&quot;op&quot;:&quot;=&quot;,&quot;val&quot;:&quot;CA&quot;}],
  &quot;orderBy&quot; : &quot;displayName&quot;,
  &quot;desc&quot;    : true,
  &quot;incDel&quot;  : true,
  &quot;limit&quot;   : 40,
  &quot;page&quot;    : &quot;BGhlbGxvAAs3&quot;
}
</code>
</pre>
    </blockquote>
    <p>
      Queries allow you to do the following:
    </p>
    <ul>
      <li>
        <p>
          Specify the following filter operators:
        </p>
        <blockquote>
          <pre>
<code>=, &lt;, &lt;=, &gt;, &gt;=, !=, %, ? (equals, less than, greater than, greater than or equal, not equal, wildcard, and full-text search)
</code>
</pre>
        </blockquote>
        <p>
          Though there is no specific range filter operator, you could get a range using other filter operators (i.e., '&gt;' and '&lt;') in two <a href="/reference/data-types/db8.html#WhereClause">where</a> clauses.
        </p>
        <p>
          The &quot;%&quot; operator (aka - the prefix operator) is a type of wildcard -- it will return all matches beginning with the value you specify. For example:
        </p>
        <blockquote>
          <pre>
<code>&quot;where&quot;:[{&quot;prop&quot;:&quot;displayName&quot;,&quot;op&quot;:&quot;%&quot;,&quot;val&quot;:&quot;J&quot;}]
</code>
</pre>
        </blockquote>
        <p>
          This where clause returns all objects whose <code>displayName</code> field begins with 'J'.
        </p>
        <p>
          In SQL, this JSON formatted where clause would look like this:
        </p>
        <blockquote>
          <pre>
<code>WHERE displayName  LIKE 'J%'
</code>
</pre>
        </blockquote>
        <p>
          <strong>Note:</strong> In db8, all where clauses are implicitly AND'd; OR is not supported.
        </p>
      </li>
      <li>
        <p>
          Order objects on a specified field in ascending or descending order.
        </p>
      </li>
      <li>
        <p>
          Limit the number of objects returned (maximum is 500).
        </p>
      </li>
      <li>
        <p>
          Get the number of objects that would have been returned if there had not been a limit.
        </p>
      </li>
      <li>
        <p>
          Include objects that have been deleted. Objects are not fully deleted until an administrative purge operation has occurred. Until then, they are simply marked as deleted.
        </p>
      </li>
      <li>
        <p>
          Use a page identifier (key) returned from one query to get the next page of objects.
        </p>
      </li>
    </ul>
    <p>
      <a name="fastQueries" id="fastQueries">&#160;</a>
    </p>
    <h3 id="all-queries-must-be-on-indexed-fields">
      All Queries Must be on Indexed Fields
    </h3>
    <p>
      It is important to note that all queries must be on indexed fields and the indexes you create determine the kind of queries you can make. This means two things:
    </p>
    <ol style="list-style-type: decimal">
      <li>
        <p>
          You can only query on an indexed property
        </p>
      </li>
      <li>
        <p>
          Your queries are limited to those that can be answered with contiguous results from the index table(s)
        </p>
      </li>
    </ol>
    <p>
      You define indexes with <a href="/reference/data-types/db8.html#IndexClause">IndexClause</a> objects when you are creating a kind with the <code>&quot;putKind&quot;</code> call. You can create multiple indexes for your kind, each of which can consist of multiple properties. Each entry in an index is an array of values. So, for instance, if you create a multiple property index composed first of a <code>&quot;state&quot;</code> property and then a <code>&quot;displayName&quot;</code> property, the entries would look like this:
    </p>
    <blockquote>
      <pre>
<code>[&quot;CA&quot;, &quot;John Doe&quot;], [&quot;CA&quot;, &quot;Mabel Syrup&quot;], [&quot;OR&quot;, &quot;Don Juan&quot;]...
</code>
</pre>
    </blockquote>
    <p>
      The indexes are ordered first by <code>state</code>, then <code>displayName</code>. This means you could get results if you queried on state (i.e., <code>state = &quot;CA&quot;</code>), since <code>state</code> values are contiguously ordered in the index, but not if you queried on <code>displayName</code>.
    </p>
    <p>
      Not only do results have to be contiguously ordered, but they have to be <strong>guaranteed</strong> to be contiguously ordered <strong><em>in advance</em></strong>. What does this mean? Let's take an example; given the following <code>[state, displayName]</code> index:
    </p>
    <blockquote>
      <pre>
<code>[&quot;CA&quot;, &quot;Helen Wheels&quot;],  [&quot;CA&quot;, &quot;Jerry Seinfeld&quot;], [&quot;CA&quot;, &quot;John Doe&quot;],
  [&quot;CA&quot;, &quot;Mabel Syrup&quot;],  [&quot;CA&quot;, &quot;Tony Soprano&quot;] 
</code>
</pre>
    </blockquote>
    <p>
      You could do a search on a single displayName entry, i.e., <code>&quot;where&quot; :[{&quot;prop&quot;:&quot;displayName&quot;, &quot;op&quot;:&quot;=&quot;, &quot;val&quot;:&quot;Tony Soprano&quot;}]</code> that would return one result. It would meet the criteria of being contiguously ordered, but there is no way of guaranteeing that in advance. Property values are not guaranteed to be unique and there could be multiple <code>&quot;Tony Soprano&quot;</code> entries in different states. To remedy this, you could create an additional index consisting of <code>displayName</code> first and, optionally, other properties after that.
    </p>
    <p>
      You need to keep the above information in mind when you are creating your indexes and how your data is going to be accessed.
    </p>
    <p>
      <a name="Atomicity" id="Atomicity">&#160;</a>
    </p>
    <hr>
    <h2 id="atomicity-and-optimistic-concurrency">
      Atomicity and Optimistic Concurrency
    </h2>
    <p>
      In an object update, atomicity means that either all of it takes place and is committed to the database, or none of it is.
    </p>
    <p>
      In db8, all updates (ie., putting or deleting multiple objects) done in a single API call are atomic. Batch operations that combine multiple operations atomically are <strong>not</strong> supported.
    </p>
    <p>
      Application-level transactions are <strong>not</strong> supported. Doing so would allow database locks to be held for a long period of time, potentially blocking other applications, including those the user is waiting on.
    </p>
    <p>
      Users can implement a form of optimistic concurrency to ensure atomicity. This would involve the following steps:
    </p>
    <ol style="list-style-type: decimal">
      <li>Get an object and note its revision value (_rev).
      </li>
      <li>Modify the object.
      </li>
      <li>Perform a conditional merge operation with a query that specifies the object's id and revision values (_id and _rev).
      </li>
      <li>If the revision number has changed, indicating it has been modified, repeat the cycle and try again.
      </li>
    </ol>
    <p>
      <a name="SchemaEnforcement" id="SchemaEnforcement">&#160;</a>
    </p>
    <hr>
    <h2 id="schema-enforcement">
      Schema Enforcement
    </h2>
    <p>
      db8 provides a mechanism for validating JSON data objects when stored with the <code>put</code> call. Your app or service can do this when creating the data object's kind with the <code>putKind</code> call using the <code>schema</code> property. For this field, enter the object's JSON schema according to official <a href="http://json-schema.org/schema">JSON standards</a>.
    </p>
    <p>
      The following is a simple example of how this works using the <code>serviceRequest</code> API.
    </p>
    <ol>
      <li>
        <p>
          Create a kind with a schema:
        </p>
        <pre>
     this.controller.serviceRequest("palm://com.palm.db/", {
        method: "putKind",
        parameters: { "id":"com.palm.schema.test:1",
                      "schema": {"id":"com.palm.schema.test:1", 
                                 "type": "object", 
                                 "properties" : { "_kind" : {"type": "string",
                                                             "value":"com.palm.schema.test:1"}, 
                                                    "foo": {"type": "string",
                                                            "description": "foo string"}, 
                                                    "bar": {"type": "string", 
                                                            "description": "bar string"},
                                                    "isMember": {"type": "boolean", 
                                                                 "description" : "Is member flag" }
                                                }
                                },
                    "owner":"com.palm.dbtest",
                    "indexes": [ {"name":"foo",
                                  "props":[{"name":"foo"}]},
                                {"name":"barfoo",
                                  "props":[{"name":"bar"},{"name":"foo"}] }]
        },
        onSuccess: function() { Mojo.Log.info("Schema test, putKind success!");},
        onFailure: function(e) { Mojo.Log.info("Schema test, putKind failure! Err = " + JSON.stringify(e));}
 });
 
</pre>
        <p>
          Output:
        </p>
        <pre>
 Schema test, putKind success!
</pre>
      </li>
      <li>
        <p>
          Store an object with all required fields:
        </p>
        <pre>
   var GoodObj = {"_kind":"com.palm.schema.test:1", "foo":"myFoo", "bar":"myBar", "isMember": true};
   var objs = [GoodObj];
   this.controller.serviceRequest("palm://com.palm.db/", {
        method: "put",
        parameters: {"objects": objs },
        onSuccess: function(e) { Mojo.Log.info("Schema test, put success! e=" + JSON.stringify(e));},
        onFailure: function(e) { Mojo.Log.info("Schema test, put failure! Err = " + JSON.stringify(e));}
 }); 
 
</pre>
        <p>
          Output:
        </p>
        <pre>
 Schema test, put success! e={"returnValue":true,"results":[{"id":"++HG_CzxbvBR_CAe","rev":8946}]}
 
</pre>
      </li>
      <li>
        <p>
          Try to store an object with a missing required field:
        </p>
        <pre>
   var BadObj = {"_kind":"com.palm.schema.test:1", "foo":"myFoo", "bar":"myBar"};
   objs = [BadObj];
   this.controller.serviceRequest("palm://com.palm.db/", {
        method: "put",
        parameters: {"objects": objs },
        onSuccess: function(e) { Mojo.Log.info("Schema test, put success! e=" + JSON.stringify(e));},
        onFailure: function(e) { Mojo.Log.info("Schema test, put failure! Err = " + JSON.stringify(e));}
 });  
 
</pre>
        <p>
          Output:
        </p>
        <pre>
 Schema test, put failure! Err = {"errorCode":-985,"errorText":"schema validation failed for kind 'com.palm.schema.test:1': required property not found - 'isMember'","returnValue":false}
 
</pre>
      </li>
      <li>
        <p>
          Try to store an object with a field that has a wrong type value:
        </p>
        <pre>
   var BadObj2 = {"_kind":"com.palm.schema.test:1", "foo":"myFoo", "bar":"myBar", "isMember":"true"};
   objs = [BadObj2];
   this.controller.serviceRequest("palm://com.palm.db/", {
        method: "put",
        parameters: {"objects": objs },
        onSuccess: function(e) { Mojo.Log.info("Schema test, put success! e=" + JSON.stringify(e));},
        onFailure: function(e) { Mojo.Log.info("Schema test, put failure! Err = " + JSON.stringify(e));}
 }); 
 
</pre>
        <p>
          Output:
        </p>
        <pre>
 Schema test, put failure! Err = {"errorCode":-985,"errorText":"schema validation failed for kind 'com.palm.schema.test:1': invalid type for property 'isMember'","returnValue":false},
 
</pre>
      </li>
    </ol>
    <p>
      <a name="ChangeNotifications" id="ChangeNotifications">&#160;</a>
    </p>
    <hr>
    <h2 id="change-notifications">
      Change Notifications
    </h2>
    <p>
      The <code>&quot;find&quot;</code> call in both the <a href="/reference/javascript-libraries/foundations/foundations-data-db.html">JS Wrapper API</a> and <a href="/reference/services/db8.html">service API</a> supports change notification. The service API also has the <code>&quot;search&quot;</code> call that supports this. When the results returned from the initial query change, the asynchronous callback provided is invoked. See the example code provided with the <code>&quot;find&quot;</code> call documentation to see how this works.
    </p>
    <p>
      <a name="UsingRevSets" id="UsingRevSets">&#160;</a>
    </p>
    <h3 id="using-revision-sets">
      Using Revision Sets
    </h3>
    <p>
      If your app or service wants to be notified only when a subset of an object's properties are updated, and you are using the <a href="/reference/services/db8.html">Service API</a>, then you can use <em>revision sets</em>. For example, a sync engine might want to be notified <em>only</em> when a contact's phone number changes. A revision set creates a property that is only updated when one of the set's properties is updated.
    </p>
    <p>
      For example, the revision set with the name <code>&quot;phoneRev&quot;</code> on the property <code>&quot;phoneNumber&quot;</code> creates a property <code>&quot;phoneRev&quot;</code> with an integer value that is set to the current value of <code>&quot;_rev&quot;</code> whenever the <code>&quot;phoneNumber&quot;</code> property is updated. This allows an app to create a watch using a query of the form <code>&quot;where phoneRev \&gt; X&quot;</code> to be notified when a phone number is updated.
    </p>
    <p>
      Revision sets are specified at kind creation with the <code>putKind</code> API. For example, the following creates a revision set for the <code>&quot;state&quot;</code> property:
    </p>
    <blockquote>
      <pre>
<code>//**
//** Note here that the revision set field (&quot;stateRev&quot;) is added to the indexes so that we can query on it later.
//**
var indexes = [{&quot;name&quot;:&quot;state&quot;, &quot;props&quot;:[{&quot;name&quot;:&quot;state&quot;}]}, {&quot;name&quot;:&quot;stateRev&quot;, &quot;props&quot;:[{&quot;name&quot;:&quot;stateRev&quot;}]} ];
var revSets = [{&quot;name&quot;:&quot;stateRev&quot;, &quot;props&quot;:[{&quot;name&quot;:&quot;state&quot;}]}];
this.controller.serviceRequest(&quot;palm://com.palm.db/&quot;, {
  method: &quot;putKind&quot;,
  parameters: { &quot;id&quot;:&quot;com.palm.sample:1&quot;,
      &quot;owner&quot;:&quot;com.palm.dbtest&quot;,
      &quot;indexes&quot;: indexes,
      &quot;revSets&quot;: revSets
  },
  onSuccess: function()  { Mojo.Log.info(&quot;putKind success!&quot;);},
  onFailure: function(e) { Mojo.Log.info(&quot;putKind failure! Err = &quot; + JSON.stringify(e));}
});
</code>
</pre>
    </blockquote>
    <p>
      After you &quot;put&quot; a record, your app can do a &quot;get&quot; to see the revision set number:
    </p>
    <blockquote>
      <pre>
<code>var contact1 = {&quot;_kind&quot;:&quot;com.palm.sample:1&quot;, &quot;name&quot;:&quot;Mabel Syrup&quot;, &quot;state&quot;:&quot;CA&quot;};
var objs = [contact1];
this.controller.serviceRequest(&quot;palm://com.palm.db/&quot;, {
  method: &quot;put&quot;,
  parameters: {&quot;objects&quot;: objs },
  onSuccess: function(e) { Mojo.Log.info(&quot;put success! e=&quot; + JSON.stringify(e)); },
  onFailure: function(e) { Mojo.Log.info(&quot;put failure! Err = &quot; + JSON.stringify(e));}
});

var id1 = &quot;++HEIviIqT+9MYkj&quot;;
var ids = [id1];
this.controller.serviceRequest(&quot;palm://com.palm.db/&quot;, {
  method: &quot;get&quot;,
  parameters: { &quot;ids&quot;: ids },
  onSuccess: function(e) { Mojo.Log.info(&quot;get success!, results =&quot;+ JSON.stringify(e));},
  onFailure: function(e) { Mojo.Log.info(&quot;get failure! Err = &quot; + JSON.stringify(e));}
});
</code>
</pre>
    </blockquote>
    <p>
      <strong>Example Output</strong>
    </p>
    <blockquote>
      <pre>
<code>get success!, results ={
  &quot;returnValue&quot;:true,
  &quot;results&quot;:[
      {
          &quot;_id&quot;:&quot;++HEIviIqT+9MYkj&quot;,
          &quot;_kind&quot;:&quot;com.palm.sample:1&quot;,
          &quot;_rev&quot;:4881,
          &quot;name&quot;:&quot;Mabel Syrup&quot;,
          &quot;state&quot;:&quot;CA&quot;,
          &quot;stateRev&quot;:4881
      }
  ]
}
</code>
</pre>
    </blockquote>
    <p>
      Using the revision set number you can the do a &quot;watch&quot; to be notified when the number gets modified (the <code>&quot;fired&quot;</code> flag is true in the results). Note that if you want to do a query on a revision set, then there has to be an index for it (see the <code>putKind</code> example above).
    </p>
    <p>
      <strong>Example:</strong>
    </p>
    <blockquote>
      <pre>
<code>var fquery = {&quot;from&quot;:&quot;com.palm.sample:1&quot;, &quot;where&quot;:[{&quot;prop&quot;:&quot;stateRev&quot;,&quot;op&quot;:&quot;&gt;&quot;,&quot;val&quot;:4881}]};
this.controller.serviceRequest(&quot;palm://com.palm.db/&quot;, {
  method: &quot;watch&quot;,
  parameters: { &quot;query&quot;: fquery},
  onSuccess: function(e)
  {
      if (!e.fired)
          Mojo.Log.info(&quot;watch initial response success, results= &quot; + JSON.stringify(e));
      else
          Mojo.Log.info(&quot;watch results changed&quot;);
  },
  onFailure: function(e) { Mojo.Log.info(&quot;watch failure! Err = &quot; + JSON.stringify(e));}
});
</code>
</pre>
    </blockquote>
    <p>
      If the <code>&quot;state&quot;</code> field is subsequently updated, the watch <em>fires</em>. For example, the following &quot;merge&quot; does this:
    </p>
    <blockquote>
      <pre>
<code>var mprops = { &quot;state&quot;:&quot;MA&quot;};
var mquery = { &quot;from&quot;:&quot;com.palm.sample:1&quot;,&quot;where&quot;:[{&quot;prop&quot;:&quot;state&quot;,&quot;op&quot;:&quot;%&quot;,&quot;val&quot;:&quot;C&quot;}] };
this.controller.serviceRequest(&quot;palm://com.palm.db/&quot;, {
  method: &quot;merge&quot;,
  parameters: { &quot;query&quot;: mquery, &quot;props&quot;: mprops },
  onSuccess: function(e) { Mojo.Log.info(&quot;merge success!, count= &quot; +e.count);},
  onFailure: function(e) { Mojo.Log.info(&quot;merge failure! Err = &quot; + JSON.stringify(e));}
});
</code>
</pre>
    </blockquote>
    <p>
      <a name="Permissions" id="Permissions">&#160;</a>
    </p>
    <hr>
    <h2 id="allowing-other-apps-or-services-to-access-your-db8-data">
      Allowing Other Apps or Services to Access Your db8 Data
    </h2>
    <p>
      If your app or service creates objects that other apps or services need to access, then you need to create a permissions file in <code>&quot;/etc/palm/db/permissions/&quot;</code>. A single file can have permissions for multiple kinds, and it is not necessary to create permissions for the kind owner as it gets all permissions implicitly.
    </p>
    <h3 id="example-1">
      Example 1
    </h3>
    <p>
      This file allows the caller all possible permissions to &quot;com.palm.foo.bar:1&quot;.
    </p>
    <blockquote>
      <pre>
<code>[
  {
      &quot;type&quot;: &quot;db.kind&quot;,
      &quot;object&quot;: &quot;com.palm.foo.bar:1&quot;,
      &quot;caller&quot;: &quot;com.palm.fooApp&quot;,
      &quot;operations&quot;: {
          &quot;create&quot;: &quot;allow&quot;,
          &quot;read&quot;: &quot;allow&quot;,
          &quot;update&quot;: &quot;allow&quot;,
          &quot;delete&quot;: &quot;allow&quot;
      }
  }
]
</code>
</pre>
    </blockquote>
    <p>
      Note that wildcards could also be used for the caller. For example:
    </p>
    <blockquote>
      <pre>
<code>&quot;caller&quot;: &quot;com.palm.*&quot;,
</code>
</pre>
    </blockquote>
    <h3 id="example-2---just-type">
      Example 2 - Just Type
    </h3>
    <p>
      For Just Type (formerly known as &quot;Universal Search&quot;), you would have to grant read permissions to <code>&quot;com.palm.launcher&quot;</code> (pardon the somewhat unintuitive name). This allows Just Type to scan your db8 data storage for entries matching the user-entered text. This also involves configuring your app's <code>appinfo.json</code> file. See <a href="/dev-guide/mojo/just-type.html">Just Type</a> for more information.
    </p>
    <blockquote>
      <pre>
<code>[
  {
      &quot;type&quot;: &quot;db.kind&quot;,
      &quot;object&quot;: &quot;com.palm.sample:1&quot;,
      &quot;caller&quot;: &quot;com.palm.launcher&quot;,
      &quot;operations&quot;: {
          &quot;read&quot;: &quot;allow&quot;
      }
  }
]
</code>
</pre>
    </blockquote>
    <p>
      <strong>Note:</strong> It is likely that 3rd party developers are <strong><em>NOT</em></strong> going to get direct access to this directory, but, in JavaScript, you can implement db8 permissions programmatically with the following <code>&quot;serviceRequest&quot;</code> call:
    </p>
    <pre>
<code>var permObj =[{&quot;type&quot;:&quot;db.kind&quot;,&quot;object&quot;:'com.palm.sample:1', 
               &quot;caller&quot;:&quot;com.palm.launcher&quot;, &quot;operations&quot;:{&quot;read&quot;:&quot;allow&quot;}}];

this.controller.serviceRequest(&quot;palm://com.palm.db/&quot;, {
        method: &quot;putPermissions&quot;,
        parameters: {&quot;permissions&quot;:permObj},
        onSuccess: function() { Mojo.Log.info(&quot;DB permission granted successfully!&quot;);},
        onFailure: function() { Mojo.Log.error(&quot;DB failed to grant permissions!&quot;);}
 });
</code>
</pre>
    <p>
      <a name="db8FAQ" id="db8FAQ">&#160;</a>
    </p>
    <hr>
    <h2 id="db8-faq">
      db8 FAQ
    </h2>
    <ul>
      <li>
        <p>
          <strong>Are there any size restrictions for a device's db8 database?</strong>
        </p>
        <p>
          There is a shared 20MB limit for all apps or services, but no per-app or service limit.
        </p>
      </li>
      <li>
        <p>
          <strong>How is a single app kept from maxing out the entire 20MB?</strong>
        </p>
        <p>
          Currently, nothing—the user can allocate all the space to one app that they really care about. In the future, there will be a UI that allows users to see and manage how much space apps are using.
        </p>
      </li>
      <li>
        <p>
          <strong>How does an app know if there is storage available and how much is left?</strong>
        </p>
        <p>
          There is not currently an API to do this. In general, this is true for all device storage resources. There may be minimum guarantees in the future, but we are not committed to it, since this would reduce the total amount of usable space. In the next few months, we will closely observe how these issues affect users and developers and respond accordingly. Making device-wide space allocation more dynamic and flexible is a high priority.
        </p>
      </li>
      <li>
        <p>
          <strong>What happens when an app tries to save to the DB when the max size has been reached?</strong>
        </p>
        <p>
          It gets an &quot;out-of-space&quot; error.
        </p>
      </li>
      <li>
        <p>
          <strong>Is data automatically culled based on, say, date?</strong>
        </p>
        <p>
          Currently, deleted objects are purged two weeks after being marked as deleted. In the future, deletion will be more aggressive and not time-based.
        </p>
      </li>
      <li>
        <p>
          <strong>Where is the db8 database file stored? Is it on <code>&quot;/media/internal&quot;</code>, so the user can back it up?</strong>
        </p>
        <p>
          It is stored on <code>&quot;/var/db&quot;</code>. By setting <code>&quot;sync&quot;:true</code> when calling <code>&quot;putKind&quot;</code>, you can have Palm back up data objects of that kind. Data is backed up on a daily basis.
        </p>
      </li>
      <li>
        <p>
          <strong>Can multiple db8 databases be open at the same time?</strong>
        </p>
        <p>
          There is only one shared db8 database. Apps or services can register multiple kinds for that database.
        </p>
      </li>
      <li>
        <p>
          <strong>How does it handle non-English characters in sorting and in queries (upper/lowercase)?</strong>
        </p>
        <p>
          Depends on the system locale and the collation strength defined on the index. With no collate property set, it sorts by utf8 codepoint. With <code>&quot;collate&quot;:&quot;primary&quot;</code> set, it does a case and accent insensitive collation using locale-specific rules (this is usually what you want when doing search). With <code>&quot;collate&quot;:&quot;secondary&quot;</code> set, it takes acccents into account in locales where accent-dependent collation is expected (usually what you want when displaying a sorted list). Read about <a href="http://userguide.icu-project.org/collation/concepts">collation concepts</a> for more information on collation strengths. Note that the collate property defined on a query must match the collate property defined on an index.
        </p>
      </li>
    </ul>
		</div>
	</body>
</html>